# AuctionProject

# ğŸ‘– ë¯¸ë‹ˆ ì›¹í”„ë¡œì íŠ¸2 - ì¤‘ê³  ë¬¼í’ˆ ê²½ë§¤ ì›¹ì‚¬ì´íŠ¸ğŸ‘–

## ëª©ì°¨

- [ê°œìš” ë° íŒ€ ì†Œê°œ](#ê°œìš”)
- [ì§„í–‰ ê³¼ì •](#í”„ë¡œì íŠ¸-ì§„í–‰-ê³¼ì •)
- [êµ¬í˜„ í™”ë©´](#êµ¬í˜„-í˜ì´ì§€)

## ê°œìš”

- í”„ë¡œì íŠ¸ ì´ë¦„: ì¤‘ê³  ë¬¼í’ˆ ê²½ë§¤ ì›¹ì‚¬ì´íŠ¸
- í”„ë¡œì íŠ¸ ëª©ì  :

  - 1ì°¨ í”„ë¡œì íŠ¸ë•Œ ì£¼ì œê°€ ëª…í™•í•˜ì§€ ì•Šì•„ ë³€ê²½
  - í•œì •íŒ ê°™ì€ ë¬¼ê±´ë“¤ì„ ê²½ë§¤ì‚¬ì´íŠ¸ì— ì˜¬ë¦¼ìœ¼ë¡œ ì†Œë¹„ì, êµ¬ë§¤ì ëª¨ë‘ ë§Œì¡± ê°€ëŠ¥
- í”„ë¡œì íŠ¸ ê¸°ê°„: 2023.11.26 - 2013.11.02
- ê°œë°œ ì—”ì§„ ë° ì–¸ì–´: Python Flask, React, MySQL, Docker, Kubernetes
- ë©¤ë²„: ê¹€ìƒí›ˆ, ìœ¤ê·œí¬, ìœ¤ì„í˜„, ìµœì¸í˜, ì „ê²½ì›

## ğŸ‘¨â€ğŸ‘¨â€ğŸ‘¦ íŒ€ì†Œê°œ

|                                                                                                                            ê¹€ìƒí›ˆ                                                                                                                            |                                                                                                                                        ìœ¤ê·œí¬                                                                                                                                        |                                                               ìœ¤ì„í˜„                                                               |                                                            ìµœì¸í˜                                                            |                                                            ì „ê²½ì›                                                            |
| :-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: | :-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: | :---------------------------------------------------------------------------------------------------------------------------------: | :---------------------------------------------------------------------------------------------------------------------------: | :---------------------------------------------------------------------------------------------------------------------------: |
| ![Static Badge](https://img.shields.io/badge/íŒ€ì¥-%23FE642E) ![Static Badge](https://img.shields.io/badge/ê²½ë§¤í˜ì´ì§€-%235882FA) ![Static Badge](https://img.shields.io/badge/ë§ˆì´í˜ì´ì§€-%235882FA) ![Static Badge](https://img.shields.io/badge/ë°°í¬ìë™í™”-%235882FA) | ![Static Badge](https://img.shields.io/badge/ë¡œê·¸ì¸&íšŒì›ê°€ì…-%235882FA)  ![Static Badge](https://img.shields.io/badge/Backend-%235882FA)    ![Static Badge](https://img.shields.io/badge/ì‹¤ì‹œê°„ë°ì´í„°ì—…ë°ì´íŠ¸-%232552FA) ![Static Badge](https://img.shields.io/badge/ì´ë¯¸ì§€ì—…ë¡œë“œ-%232552FA) | ![Static Badge](https://img.shields.io/badge/ë§ˆì´í˜ì´ì§€-%235882FA)  ![Static Badge](https://img.shields.io/badge/gití˜•ìƒê´€ë¦¬-1235882FA) | ![Static Badge](https://img.shields.io/badge/ë©”ì¸í˜ì´ì§€-%235882FA) ![Static Badge](https://img.shields.io/badge/ë””ìì¸-1235882FA) | ![Static Badge](https://img.shields.io/badge/ë””ìì¸-%235882FA) ![Static Badge](https://img.shields.io/badge/ë°°í¬ìë™í™”-1235882FA) |

### âš™ï¸ ê¸°ìˆ  ìŠ¤íƒ

#### FRONTEND

![React](https://img.shields.io/badge/react-%2320232a.svg?style=for-the-badge&logo=react&logoColor=%2361DAFB)

#### BACKEND

![Python](https://img.shields.io/badge/python-3670A0?style=for-the-badge&logo=python&logoColor=ffdd54)
![MySQL](https://img.shields.io/badge/mysql-%2300f.svg?style=for-the-badge&logo=mysql&logoColor=white)

#### ìë™ ë°°í¬í™” ë„êµ¬

<img src="https://img.shields.io/badge/Docker-2496ED?style=flat-square&logo=Docker&logoColor=white"/>

![Kubernetes](https://img.shields.io/badge/kubernetes-%23326ce5.svg?style=for-the-badge&logo=kubernetes&logoColor=white)

## í”„ë¡œì íŠ¸ ì§„í–‰ ê³¼ì •

|       ì¼ë³„       | ë‚´ìš©                                                                   |
| :--------------: | ---------------------------------------------------------------------- |
|  1ì¼ì°¨ `<br>`  | - ì£¼ì œ ì„ ì •, ê¸°ìˆ  ìŠ¤íƒ ê²°ì •, ë°ì´í„° ë² ì´ìŠ¤ ì„¤ê³„                        |
| 2~6ì¼ì°¨ `<br>` | - CRUD ê¸°ëŠ¥ ê°œë°œ                                                       |
|  7ì¼ì°¨ `<br>`  | - ë„ì»¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê³ , ì¿ ë²„ë„¤í‹°ìŠ¤ë¥¼ í†µí•´ í´ëŸ¬ìŠ¤í„°ì— ë°°í¬ |
|  8ì¼ì°¨ `<br>`  | - í”„ë¡œì íŠ¸ ë³´ê³ ì„œ ì‘ì„± ë° ë°œí‘œ                                         |

## í”„ë¡œì íŠ¸ êµ¬ì¡° ë° íŠ¹ì§•

### ER DIAGRAM

![1698895705067](image/README/1698895705067.png)

### BACKEND

- APIëª…ì„ ì¹´ë©œ ì¼€ì´ìŠ¤ë¡œ ì •ì˜í•˜ì—¬ ë„¤ì´ë° ì»¨ë²¤ì…˜ì„ ì§€í‚¤ë„ë¡ í•˜ì˜€ìŠµë‹ˆë‹¤.

ğŸ“¦backend
 â”£ ğŸ“‚node_modules
 â”ƒ â”£ ğŸ“‚flask-cors
 â”ƒ â”ƒ â”— ğŸ“œpackage.json
 â”ƒ â”— ğŸ“œ.package-lock.json
 â”£ ğŸ“‚resources # í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì‚¬ìš©ìê°€ ì—…ë¡œë“œí•œ ì´ë¯¸ì§€ë¥¼ ì €ì¥
 â”ƒ â”£ ğŸ“œimage.jpeg
 â”ƒ â”£ ğŸ“œme.png
 â”ƒ â”£ ğŸ“œê¹€ìƒí›ˆ.JPEG
 â”ƒ â”£ ğŸ“œìš°ì˜ë¯¸.JPEG
 â”ƒ â”— ğŸ“œìº¡ì²˜.JPG
 â”£ ğŸ“‚__pycache__
 â”ƒ â”— ğŸ“œdatabase.cpython-312.pyc
 â”£ ğŸ“œapp.py
 â”£ ğŸ“œdatabase.py
 â”£ ğŸ“œDockerfile-flask
 â”£ ğŸ“œDockerfile-mysql
 â”£ ğŸ“œhistoryUpdate.py #ì£¼ê¸°ì ìœ¼ë¡œ ë‚™ì°°ë‚´ì—­ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” cronì— ì‚¬ìš©ë˜ëŠ” íŒŒì¼
 â”£ ğŸ“œinit.sql
 â”— ğŸ“œrequirements.txt

- `JWT`ì„ ë§Œë“¤ì–´ì„œ ë¡œê·¸ì¸ ì •ë³´ ìˆì„ ì‹œ `localStorage`ì— ì €ì¥ -
  - ì´ ë°©ë²•ì€ ë³´ì•ˆ ìƒ ì·¨ì•½ -> Access Tokenì„ ìœ íš¨ ê¸°ê°„ì„ ì§§ê²Œ ì„¤ì •í•˜ê³ ,  ë§Œë£Œë˜ë©´ Refresh Tokenì„ ë°œê¸‰ë°›ë„ë¡ í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ê°œì„  ê°€

```python
from flask_jwt_extended import JWTManager
from flask_jwt_extended import create_access_token
import os


app.config["JWT_SECRET_KEY"] = "super-secret"
app.config['UPLOAD_FOLDER'] = UPLOAD_FOLDER
jwt = JWTManager(app)

@app.route('/login', methods = ["GET", "POST"])
def login():
    if request.method == 'POST':
        userId = request.json.get('id')
        password = request.json.get('password')
   
        isid = database.idCheck(userId, password)
        if(isid) :
            access_token = create_access_token(identity=userId)
            return jsonify({'token': access_token, 'userId':userId}), 200
        else : 
            return jsonify({'message': 'ì˜ëª»ëœ ë¡œê·¸ì¸ ì •ë³´ì…ë‹ˆë‹¤. ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.'}), 401

```

- ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì£¼ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ìë™í™” ì‘ì—…
- ë§¤ë¶„ ë§¤ì´ˆì— crontabì„ ì‹¤í–‰í•˜ë©° ê²½ë§¤ ë‚´ì—­ì— ìˆëŠ” ë°ì´í„°ì˜ ë§Œë£Œì‹œê°„ì´ í˜„ì¬ì‹œê°„ì„ ì§€ë‚¬ì„ ê²½ìš° history(ë‚™ì°° í…Œì´ë¸”)ì— ìë™ìœ¼ë¡œ ë„£ëŠ” python íŒŒì¼ ì‹¤í–‰í•œë‹¤.
  - frontendì—ì„œë„ í˜„ì¬ì‹œê°„ì„ ì§€ë‚¬ìœ¼ë©´ ë‚™ì°° ëª»í•˜ê²Œ ë²„íŠ¼ ë¹„í™œì„±í™”í•˜ê²Œ ê°œì„  ê°€ëŠ¥

```docker
RUN crontab -l | { cat; echo "* * * * * /usr/local/bin/python /app/historyUpdate.py >> /var/log/cron.log 2>&1"; } | crontab -
```

- backend resourceì— ì´ë¯¸ì§€ ì €ì¥
  - ì„¤ì • ë³€ìˆ˜ì— ë„£ì–´ë†“ì€ ì ˆëŒ€ ê²½ë¡œì— ì´ë¯¸ì§€ ì €ì¥
  - ë°ì´í„°ë² ì´ìŠ¤ì— ë„£ì„ ë•ŒëŠ” í•´ë‹¹ íŒŒì¼ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” URLì„ ìƒì„± í›„ INSERT

```python
file.save(os.path.join(app.config['UPLOAD_FOLDER'], file.filename))
image_url = 'http://10.0.0.9:5000/resources/' + file.filename

```

### FRONTEND

- ì»´í¬ë„ŒíŠ¸ì™€ í˜ì´ì§€ë¥¼ ë¶„ë¦¬í•¨ìœ¼ë¡œ, ì—¬ëŸ¬ í˜ì´ì§€ì—ì„œ ì‚¬ìš©ëŠ” ì¹´ë“œ, í—¤ë” ë“±ì„ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.
- 

ğŸ“¦src
 â”£ ğŸ“‚components
 â”ƒ â”£ ğŸ“œCard.js
 â”ƒ â”£ ğŸ“œCard.module.css
 â”ƒ â”£ ğŸ“œCreatePage.module.css
 â”ƒ â”£ ğŸ“œDetailPage.module.css
 â”ƒ â”£ ğŸ“œFooter.js
 â”ƒ â”£ ğŸ“œFooter.module.css
 â”ƒ â”£ ğŸ“œHeader.js
 â”ƒ â”£ ğŸ“œHeader.module.css
 â”ƒ â”£ ğŸ“œLoginPage.module.css
 â”ƒ â”£ ğŸ“œMainPage.module.css
 â”ƒ â”— ğŸ“œMyPage.module.css
 â”£ ğŸ“‚pages
 â”ƒ â”£ ğŸ“œCreatePage.js
 â”ƒ â”£ ğŸ“œDetailPage.js
 â”ƒ â”£ ğŸ“œLoginPage.js
 â”ƒ â”£ ğŸ“œMainPage.js
 â”ƒ â”£ ğŸ“œMyPage.js
 â”ƒ â”— ğŸ“œSignupPage.js
 â”£ ğŸ“œApp.css
 â”£ ğŸ“œApp.js
 â”£ ğŸ“œApp.test.js
 â”£ ğŸ“œindex.css
 â”£ ğŸ“œindex.js
 â”£ ğŸ“œlogo.svg
 â”£ ğŸ“œreportWebVitals.js
 â”— ğŸ“œsetupTests.js

- Axiosë¥¼ ì‚¬ìš©í•˜ì—¬ ì„œë²„ì™€ì˜ HTTP ìš”ì²­ì„ ë§Œë“¤ê³  ì‘ë‹µì„ ì²˜ë¦¬

```javascript
axios
      .put(`http://10.0.0.9:5000/detail/${id}`, { price: price })
      .then((response) => {
        setData({ ...data, price: price });
        console.log("ê°€ê²©ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.");

        const datas = new FormData();
        datas.append('itemId', data.id);
        datas.append('userId', purchaseId);
        datas.append('endTime', data.endTime);
        console.log(data.id)
        console.log(purchaseId)

        return axios.post(`http://10.0.0.9:5000/history`, datas);
      })
      .catch((error) => {
        console.error(error);
      });
```

- async/await: asyncí•¨ìˆ˜ ë‚´ë¶€ì—ì„œ awaitë¡œ ì„œë²„ì™€ í†µì‹ í•˜ê³  promiseê°€ ëë‚˜ë©´
  ì²˜ë¦¬ ê²°ê³¼ì— ë”°ë¼ ë‹¤ë¥¸ ê²°ê³¼ ë°˜í™˜
- ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ ë‹¤ë¥¸ ì‘ì—…ì„ ë³‘ë ¬ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆì–´ ì‹œìŠ¤í…œ ì„±ëŠ¥ í–¥ìƒ ê°€ëŠ¥

```javascript

 const handlerLogin = async () => {
    try {
      const response = await fetch(`http://10.0.0.9:5000/login`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ id, password })
      });
      console.log(response)

      if (response.ok) {
        console.log('ë¡œê·¸ì¸ ì„±ê³µ! í† í°:', token);
      } else {
        console.log('ë¡œê·¸ì¸ ì‹¤íŒ¨!');
      }
    } catch (error) {
      console.error('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
    }
};

```

ì•ì„œ ë§Œë“¤ì—ˆë˜ React, Flask, Mysql Databaseë¥¼ ì´ìš©í•´ 3-tier-SPAë¥¼ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤. ë°°í¬ ìë™í™”ë¥¼ ìœ„í•´ì„œ ê³¼ì •ì„ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.

# Docker Container
## Mysql Database ì»¨í…Œì´ë„ˆí™”
###  Databaseë¥¼ Mysql Workbenchì˜ Forwarding toolë¡œ DB DDL ì¶”ì¶œ
```sql
CREATE SCHEMA IF NOT EXISTS `auction` DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci ;
USE `auction` ;

-- -----------------------------------------------------
-- Table `auction`.`user`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `auction`.`user` (
  `id` VARCHAR(50) NOT NULL,
  `phone` VARCHAR(50) NOT NULL,
  `password` VARCHAR(50) NOT NULL,
  `nickname` VARCHAR(50) NULL DEFAULT NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `auction`.`history`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `auction`.`history` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` varchar(50) NOT NULL,
  `item_id` int NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=27 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
-- -----------------------------------------------------
-- Table `auction`.`item`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `auction`.`item` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `endTime` DATETIME NOT NULL,
  `startTime` DATETIME NOT NULL,
  `name` VARCHAR(100) NOT NULL,
  `content` TEXT NULL DEFAULT NULL,
  `price` DOUBLE NOT NULL,
  `user_id` VARCHAR(50) NOT NULL,
  `image` VARCHAR(200) NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `fk_item_user_idx` (`user_id` ASC) VISIBLE,
  CONSTRAINT `fk_item_user`
    FOREIGN KEY (`user_id`)
    REFERENCES `auction`.`user` (`id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB
AUTO_INCREMENT = 32
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;


-- -----------------------------------------------------
-- Table `auction`.`history`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `auction`.`prehistory` (
  `id` int NOT NULL AUTO_INCREMENT,
  `user_id` varchar(50) NOT NULL,
  `item_id` int NOT NULL,
  `endTime` datetime NOT NULL,
  PRIMARY KEY (`id`),
  KEY `fk_prehistory_user1_idx` (`user_id`),
  KEY `fk_prehistory_item1_idx` (`item_id`),
  CONSTRAINT `fk_prehistory_item1` FOREIGN KEY (`item_id`) REFERENCES `item` (`id`),
  CONSTRAINT `fk_prehistory_user1` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`)
)
ENGINE = InnoDB
AUTO_INCREMENT = 6
DEFAULT CHARACTER SET = utf8mb4
COLLATE = utf8mb4_0900_ai_ci;

CREATE USER 'user1'@'%' IDENTIFIED BY '1234';
GRANT ALL ON auction.* TO 'user1'@'%';
```
### Mysql Database Dockerfile ì‘ì„±
C:\miniProjectFront\Dockerfile
```Dockerfile
FROM mysql:8.0
# ENV MYSQL_ROOT_USER=root
ENV MYSQL_ROOT_PASSWORD=1234
COPY ./init.sql /docker-entrypoint-initdb.d
```
### ì‘ì„±í•œ Dockerfileë¡œ mysql db ì´ë¯¸ì§€ ë¹Œë“œ
C:\Users\User\Desktop\miniProjectBack>docker image build -t mysql:2.0 -f Dockerfile-mysql .
```
[+] Building 1.7s (8/8) FINISHED                                                                         docker:default
 => [internal] load .dockerignore                                                                                  0.0s
 => => transferring context: 2B                                                                                    0.0s
 => [internal] load build definition from Dockerfile-mysql                                                         0.0s
 => => transferring dockerfile: 165B                                                                               0.0s
 => [internal] load metadata for docker.io/library/mysql:8.0                                                       1.6s
 => [auth] library/mysql:pull token for registry-1.docker.io                                                       0.0s
 => [internal] load build context                                                                                  0.0s
 => => transferring context: 30B                                                                                   0.0s
 => [1/2] FROM docker.io/library/mysql:8.0@sha256:974cac08fff819ea2dfeb83fed4d2eb5100bb79603aff6148bdc53d8be4895f  0.0s
 => CACHED [2/2] COPY ./init.sql /docker-entrypoint-initdb.d                                                       0.0s
 => exporting to image                                                                                             0.0s
 => => exporting layers                                                                                            0.0s
 => => writing image sha256:a8d83556830d94594cfec7bee72cfd8950c86c0698d63c4150ab8e29ccfa393b                       0.0s
 => => naming to docker.io/library/mysql:2.0
```
## Flask ì»¨í…Œì´ë„ˆí™”
### Flask Dockerfile ì‘ì„±
C:\miniProjectFront\Dockerfile
```Dockerfile
FROM python:3.11
RUN apt-get update && apt-get install -y cron
WORKDIR /app
COPY . .
RUN pip install jwt
RUN pip install --no-cache-dir -r requirements.txt
#COPY crontabFile /etc/cron.d/cronfile
#RUN chmod 0644 /etc/cron.d/cronfile
RUN crontab -l | { cat; echo "* * * * * /usr/local/bin/python /app/historyUpdate.py >> /var/log/cron.log 2>&1"; } | crontab -
CMD ["sh", "-c", "cron && python app.py"]
```
### ì‘ì„±í•œ Dockerfileë¡œ  flask ì´ë¯¸ì§€ ë¹Œë“œ
C:\Users\User\Desktop\miniProjectBack>docker image build -t flask:2.0 -f Dockerfile-flask .
```
[+] Building 31.1s (6/12)                                                                                docker:default
 => [internal] load build definition from Dockerfile-flask                                                         0.0s
 => => transferring dockerfile: 465B                                                                               0.0s
 => [internal] load .dockerignore                                                                                  0.0s
 => => transferring context: 2B                                                                                    0.0s
 => [internal] load metadata for docker.io/library/python:3.11                                                     2.6s
 => [auth] library/python:pull token for registry-1.docker.io                                                      0.0s
 => [1/7] FROM docker.io/library/python:3.11@sha256:6deadd529bed8232c98895a58fa8d689bdba285e9ceb92cda1f5fd8fa4a7  26.9s
 => => resolve docker.io/library/python:3.11@sha256:6deadd529bed8232c98895a58fa8d689bdba285e9ceb92cda1f5fd8fa4a78  0.0s
 => => sha256:325c5bf4c2f26c11380501bec4b6eef8a3ea35b554aa1b222cbcd1e1fe11ae1d 64.13MB / 64.13MB                   8.8s
 => => sha256:6deadd529bed8232c98895a58fa8d689bdba285e9ceb92cda1f5fd8fa4a78fa1 2.14kB / 2.14kB                     0.0s
 => => sha256:99cb81c1d8e4d6fe275c1f5127c770ad86a64286533e06991e1887d3e18aa812 2.01kB / 2.01kB                     0.0s
 => => sha256:3f7984adbac453e46f5063ac7193e461419ad446f25ecbd84f9a38edf36e4ce4 7.53kB / 7.53kB                     0.0s
 => => sha256:8457fd5474e70835e4482983a5662355d892d5f6f0f90a27a8e9f009997e8196 49.58MB / 49.58MB                   8.1s
 => => sha256:13baa2029dde87a21b87127168a0fb50a007c07da6b5adc8864e1fe1376c86ff 24.05MB / 24.05MB                   2.4s
 => => sha256:7e18a660069fd7f87a7a6c49ddb701449bfb929c066811777601d36916c7f674 211.06MB / 211.06MB                13.5s
 => => sha256:98a59f0ffedebe05b4e1ada824cb5389ff0552e77d501d89554a0d705b642d73 6.39MB / 6.39MB                    10.8s
 => => extracting sha256:8457fd5474e70835e4482983a5662355d892d5f6f0f90a27a8e9f009997e8196                          5.0s
 => => sha256:3a5444633a3348f11441df77b3fe52d2315b6ba0292a683a5b00ee77bd55581c 19.79MB / 19.79MB                  13.6s
 => => sha256:bbbc9b405dabdd464f2648e63d47bcb6233868b806ef20c51111bfe88a37829e 244B / 244B                        11.1s
 => => sha256:d9992232ef9b080bff5a001d720504d9fab61a70d5c5fef2b51c918b06758de9 3.11MB / 3.11MB                    12.3s
 => => extracting sha256:13baa2029dde87a21b87127168a0fb50a007c07da6b5adc8864e1fe1376c86ff                          0.7s
 => => extracting sha256:325c5bf4c2f26c11380501bec4b6eef8a3ea35b554aa1b222cbcd1e1fe11ae1d                          3.1s
 => => extracting sha256:7e18a660069fd7f87a7a6c49ddb701449bfb929c066811777601d36916c7f674                          7.6s
 => => extracting sha256:98a59f0ffedebe05b4e1ada824cb5389ff0552e77d501d89554a0d705b642d73                          0.3s
 => => extracting sha256:3a5444633a3348f11441df77b3fe52d2315b6ba0292a683a5b00ee77bd55581c                          0.7s
 => => extracting sha256:bbbc9b405dabdd464f2648e63d47bcb6233868b806ef20c51111bfe88a37829e                          0.0s
 => => extracting sha256:d9992232ef9b080bff5a001d720504d9fab61a70d5c5fef2b51c918b06758de9                          0.3s
 => [internal] load build context                                                                                  0.2s
 => => transferring context: 284.08kB
```
## React ì»¨í…Œì´ë„ˆí™”
### React Dockerfile ì‘ì„±
C:\miniProjectBack\Dockerfile
```Dockerfile
FROM python:3.11
RUN apt-get update && apt-get install -y cron
WORKDIR /app
COPY . .
RUN pip install jwt
RUN pip install --no-cache-dir -r requirements.txt
#COPY crontabFile /etc/cron.d/cronfile
#RUN chmod 0644 /etc/cron.d/cronfile
RUN crontab -l | { cat; echo "* * * * * /usr/local/bin/python /app/historyUpdate.py >> /var/log/cron.log 2>&1"; } | crontab -
CMD ["sh", "-c", "cron && python app.py"]
```

### ì‘ì„±í•œ Dockerfileë¡œ React ì´ë¯¸ì§€ ë¹Œë“œ
C:\Users\User\Desktop\miniProjectFront>docker image build -t react:2.0 .
```
[+] Building 6.0s (8/15)                                                                                 docker:default
 => [internal] load .dockerignore                                                                                  0.0s
 => => transferring context: 2B                                                                                    0.0s
 => [internal] load build definition from Dockerfile                                                               0.0s
 => => transferring dockerfile: 291B                                                                               0.0s
 => [internal] load metadata for docker.io/library/nginx:latest                                                    2.6s
 => [internal] load metadata for docker.io/library/node:latest                                                     2.6s
 => [auth] library/nginx:pull token for registry-1.docker.io                                                       0.0s
 => [auth] library/node:pull token for registry-1.docker.io                                                        0.0s
 => [builder 1/6] FROM docker.io/library/node@sha256:0052410af98158173b17a26e0e2a46a3932095ac9a0ded660439a8ffae65  3.3s
 => => resolve docker.io/library/node@sha256:0052410af98158173b17a26e0e2a46a3932095ac9a0ded660439a8ffae65b1e3      0.2s
 => => sha256:c30e0acec6d561f6ec4e8d3ccebdeedbe505923a613afe3df4a6ea0a40f2240a 3.37kB / 3.37kB                     0.3s
 => => sha256:6cc2ae4489b295d2ae25b6931f9d5523479c7e6e85f66dde06b150ec33e4003f 49.64MB / 49.64MB                   3.0s
 => => sha256:0052410af98158173b17a26e0e2a46a3932095ac9a0ded660439a8ffae65b1e3 1.21kB / 1.21kB                     0.0s
 => => sha256:a59381eeb372ade238dcde65dce1fb6ad48c4eda288bf4e3e50b94176ee67d60 2.00kB / 2.00kB                     0.0s
 => => sha256:b612cbc8128d478d7f30c1bae6b2890433ae510c200907f4590e228e774e6160 7.53kB / 7.53kB                     0.0s
 => => sha256:2c7b705ed4b2417684e41f5b27d5edeb4978bc50ebdc5c085f0c90725cbbb610 2.23MB / 2.23MB                     1.0s
 => => extracting sha256:c30e0acec6d561f6ec4e8d3ccebdeedbe505923a613afe3df4a6ea0a40f2240a                          0.0s
 => => sha256:36b2736268362c5a83ffe8fd2520b48572d80b9511ee0b84d13e7f63befcbdd0 450B / 450B                         1.0s
 => => extracting sha256:6cc2ae4489b295d2ae25b6931f9d5523479c7e6e85f66dde06b150ec33e4003f
```

### ë¹Œë“œëœ ì´ë¯¸ì§€ë“¤ í™•ì¸
C:\Users\User\Desktop\miniProjectFront>docker image ls
```
REPOSITORY                                TAG                                        IMAGE ID       CREATED         SIZE
flask                                     2.0                                        c673b4d2fbd5   5 minutes ago   1.34GB
react                                     2.0                                        c0ab8f938e1d   17 hours ago    190MB
mysql                                     1.0                                        a8d83556830d   17 hours ago    582MB
mysql                                     2.0                                        a8d83556830d   17 hours ago    582MB
```
## Mysql, flask, React ì»¨í…Œì´ë„ˆ ê°ê° ìƒì„±
C:\Users\User\Desktop\miniProjectFront>docker container run -d mysql
```
f0febcc12648bcd89369413a16ff2a5114fc95d1de8f82c29a15d0a5bc470b23
```
C:\Users\User\Desktop\miniProjectFront>docker container run -d flask:2.0
```
b8e8f7ed452a4c129d549575cb31379c0c86447fd82deb61f71bc4e2d37fd07e
```
C:\Users\User\Desktop\miniProjectFront>docker container run -d react:2.0
```
0225e62d95f994a4c13b29c0eeb10be6f8d02e2ad920a7ea7dd17b9cecf51fe6
```
## ìƒì„±ëœ ì»¨í…Œì´ë„ˆë“¤ í™•ì¸
C:\Users\User\Desktop\miniProjectFront>docker container ls
```
CONTAINER ID   IMAGE                       COMMAND                   CREATED              STATUS              PORTS     NAMES
0225e62d95f9   react:2.0                   "/docker-entrypoint.â€¦"   About a minute ago   Up About a minute   80/tcp    exciting_hertz
b8e8f7ed452a   flask:2.0                   "sh -c 'cron && pythâ€¦"   About a minute ago   Up About a minute             eager_chaum
```
## Mysql Databaseì™€ Flask Backend ê²°í•©í•˜ê¸°
- Docker-compose.yaml ì‘ì„±í•´ì„œ ê²°í•©í•˜ê¸° 
- ë„¤íŠ¸ì›Œí¬ ìƒì„± í›„ Databaseì™€ Flaskë¥¼ ê°™ì€ ë„¤íŠ¸ì›Œí¬ì— ë°°ì •

ë‘˜ ì¤‘ ë„¤íŠ¸ì›Œí¬ ìƒì„±í•´ì„œ ì»¨í…Œì´ë„ˆë“¤ì„ ë°°ì •í•˜ëŠ” ë°©ë²• ì±„íƒ

## ë„¤íŠ¸ì›Œí¬ ìƒì„±í•˜ê¸° 
C:\Users\User\Desktop\miniProjectFront>docker network create lastdance
```
862453dd5b76ea62c6cfac2871638f23e894b516866984a804753111fdff12ff
```
## ìƒì„±í•œ ë„¤íŠ¸ì›Œí¬ í™•ì¸
C:\Users\User\Desktop\miniProjectFront>docker network ls
```
NETWORK ID     NAME        DRIVER    SCOPE
59aa4a23c272   bridge      bridge    local
ff5b36b6f513   host        host      local
862453dd5b76   lastdance   bridge    local
1b11b7589d74   mynetwork   bridge    local
c5c8c316b476   network-a   bridge    local
e161b435858e   none        null      local
96b0798a4e9c   test        bridge    local
```
## ìƒì„±í–ˆë˜ Mysql ì»¨í…Œì´ë„ˆ CLI í™˜ê²½ì—ì„œ ì‹¤í–‰ 
```
C:\Users\User\Desktop\miniProjectFront>docker container exec -it 4661265c2ff7 /bin/bash
					       				
bash-4.4# mysql -u root -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 8
Server version: 8.0.35 MySQL Community Server - GPL

Copyright (c) 2000, 2023, Oracle and/or its affiliates.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql> use auction
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Database changed
mysql> show tables;
+-------------------+
| Tables_in_auction |
+-------------------+
| history           |
| item              |
| prehistory        |
| user              |
+-------------------+
4 rows in set (0.00 sec)

mysql> desc history
    -> ;
+---------+-------------+------+-----+---------+----------------+
| Field   | Type        | Null | Key | Default | Extra          |
+---------+-------------+------+-----+---------+----------------+
| id      | int         | NO   | PRI | NULL    | auto_increment |
| user_id | varchar(50) | NO   |     | NULL    |                |
| item_id | int         | NO   |     | NULL    |                |
+---------+-------------+------+-----+---------+----------------+
3 rows in set (0.00 sec)
```
## ìƒì„±í–ˆë˜ Networkì— ì»¨í…Œì´ë„ˆë“¤ ê°ê° ë°°ì •

C:\Users\User\Desktop\miniProjectFront>docker container run -d -p 5000:5000 --network lastdance --name flask flask:2.0
```
3fb802a031d42ae70d23933a8effc952f7cd34331d06481766f69b31905b6681
```
C:\Users\User\Desktop\miniProjectFront>docker container run -d --network lastdance --name mysql mysql:2.0
```
fdda530a8261b26d81466d035825c605105e53c89616e14bceef64ede3855eb7
```
C:\Users\User\Desktop\miniProjectFront>docker container run -d -p 3000:80 --network mynetwork --name react react:2.0
```
c4719ce8fd73681f6786b81c66053fa3512cb86d594b1fdad3f25a66e08d3d3a
```
C:\Users\User\Desktop\miniProjectFront>docker container ls
```
CONTAINER ID   IMAGE                       COMMAND                   CREATED              STATUS              PORTS                    NAMES
fdda530a8261   mysql:2.0                   "docker-entrypoint.sâ€¦"   6 seconds ago        Up 5 seconds        3306/tcp, 33060/tcp      mysql
c4719ce8fd73   react:2.0                   "/docker-entrypoint.â€¦"   About a minute ago   Up About a minute   0.0.0.0:3000->80/tcp     react
3fb802a031d4   flask:2.0                   "sh -c 'cron && pythâ€¦"   3 minutes ago        Up 3 minutes        0.0.0.0:5000->5000/tcp   flask
```

# Kubernetes
## ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ì…‹ì—…
### ê°€ìƒë¨¸ì‹  ìƒì„± 
c:\kubernetis\vagrant-kubeadm-kubernetes>vagrant up
```
Bringing machine 'master' up with 'virtualbox' provider...
Bringing machine 'node01' up with 'virtualbox' provider...
Bringing machine 'node02' up with 'virtualbox' provider...
==> master: Checking if box 'bento/ubuntu-22.04' version '202309.08.0' is up to date...
==> master: Machine already provisioned. Run `vagrant provision` or use the `--provision`
==> master: flag to force provisioning. Provisioners marked to run always will still run.
==> node01: Checking if box 'bento/ubuntu-22.04' version '202309.08.0' is up to date...
==> node01: Machine already provisioned. Run `vagrant provision` or use the `--provision`
==> node01: flag to force provisioning. Provisioners marked to run always will still run.
==> node02: Checking if box 'bento/ubuntu-22.04' version '202309.08.0' is up to date...
==> node02: Machine already provisioned. Run `vagrant provision` or use the `--provision`
==> node02: flag to force provisioning. Provisioners marked to run always will still run.
```
### master-node ì— ì ‘ì†
c:\kubernetis\vagrant-kubeadm-kubernetes>vagrant ssh master
```
Welcome to Ubuntu 22.04.3 LTS (GNU/Linux 5.15.0-83-generic x86_64)
```
### VSCode í™•ì¥ì—°ê²°
![1698901610067](image/1ì¡°ìœ¤ì„í˜„/1698901610067.png)
### ì‹œí¬ë¦¿ ìƒì„± ë° í™•ì¸
#### ì‹œí¬ë¦¿ ìƒì„± ì˜ˆì‹œ(ì—†ì„ ê²½ìš°)
```
vagrant@master-node:~$ kubectl create secret docker-registry regcred --docker-server=https://index.docker.io/v1/ --docker-username=****** --docker-password=****** --docker-email=******
```
#### ìƒì„±ëœ ì‹œí¬ë¦¿ ë‚´ìš© ì¡°íšŒ
```
vagrant@master-node:~$ kubectl get secret regcred --output=yaml
apiVersion: v1
data:
  .dockerconfigjson: eyJhdXRocyI6eyJodHRwczovL2luZGV4LmRvY2tlci5pby92MS8iOnsidXNlcm5hbWUiOiJteWFuamluaSIsInBhc3N3b3JkIjoiQGN3bnU5MjE4IiwiZW1haWwiOiJteWFuamluaUBnbWFpbC5jb20iLCJhdXRoIjoiYlhsaGJtcHBibWs2UUdOM2JuVTVNakU0In19fQ==
kind: Secret
metadata:
  creationTimestamp: "2023-10-06T02:20:17Z"
  name: regcred
  namespace: default
  resourceVersion: "94204"
  uid: 17919b56-c624-4a43-84fa-3eb551b0b2cc
type: kubernetes.io/dockerconfigjson
```
#### ì•”í˜¸í™”ëœ ì‹œí¬ë¦¿ ë³µí˜¸í™”
```
vagrant@master-node:~$ kubectl get secret regcred --output="jsonpath={.data.\.dockerconfigjson}" | base64 --decode
{"auths":{"https://index.docker.io/v1/":{"username":"myanjini","password":"*****","email":"myanjini@gmail.com","auth":"bXlhbmppbmk6QGN3bnU5MjE4"}}}
```
## mysql-deployment.yaml íŒŒì¼ ì‘ì„±
/home/vagrant/mysql-deployment.yaml
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mysql-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: mysql
  template:
    metadata:
      name: mysql-pod
      labels:
        app: mysql
    spec:
      containers:
      - name: mysql
        image: docker.io/shyun815/mysql:3.0
        env:
        - name: MYSQL_ROOT_PASSWORD
          value: "1234"        
        ports:
        - containerPort: 3306
        volumeMounts:
        - name: mysql-data
          mountPath: /var/lib/mysql  
          subPath: mysql
      imagePullSecrets:
      - name: regcred
      volumes:
      - name: mysql-data
        persistentVolumeClaim:
          claimName: mysql-pvc
---
apiVersion: v1
kind: Service
metadata:
  name: mysql-service
spec:
  type: LoadBalancer        # ì„œë¹„ìŠ¤ íƒ€ì…(ê¸°ë³¸ê°’ì´ ClusterIP)
  ports:                    
  - name: mysql
    port: 3306              # ì„œë¹„ìŠ¤ì˜ IPì— ì ‘ê·¼í•  ë•Œ ì‚¬ìš©í•  í¬íŠ¸
    targetPort: 3306        # selector í•­ëª©ì—ì„œ ì •ì˜í•œ ë¼ë²¨ì— ì˜í•´ ì ‘ê·¼ ëŒ€ìƒì´ ëœ íŒŒë“œ ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•˜ëŠ” í¬íŠ¸ 
  selector:                 # ì–´ë–¤ ë¼ë²¨ì˜ íŒŒë“œì— ì ‘ê·¼í•  ìˆ˜ ìˆê²Œ ë§Œë“¤ ê²ƒì¸ì§€ ê²°ì •
    app: mysql              # íŒŒë“œì˜ ë¼ë²¨
```

## flask-deployment.yaml íŒŒì¼ ì‘ì„±
/home/vagrant/flask-deployment.yaml
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: flask-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: flask
  template:
    metadata:
      name: flask-pod
      labels:
        app: flask
    spec:
      containers:
      - name: flask
        image: docker.io/shyun815/flask:1.0
        ports:
        - containerPort: 5000
      imagePullSecrets:
      - name: mysecret  
---       
apiVersion: v1
kind: Service
metadata:
  name: flask-service
spec:
  type: LoadBalancer
  loadBalancerIP: 10.0.0.4
  ports:
  - name: flask
    port: 5000
    targetPort: 5000
  selector:
    app: flask
```
## react-deployment.yaml íŒŒì¼ ì‘ì„±
/home/vagrant/react-deployment.yaml
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: react-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: react
  template:
    metadata:
      name: react-pod
      labels:
        app: react
    spec:
      containers:
      - name: react
        image: docker.io/shyun815/react:1.0
        ports:
        - containerPort: 3000
      imagePullSecrets:
      - name: regcred 
---       
apiVersion: v1
kind: Service
metadata:
  name: react-service
spec:
  type: LoadBalancer  
  ports:             
  - name: react
    port: 3000       
    targetPort: 80      
  selector:
    app: react
```    
## í†µì‹  
- POD ë¼ë¦¬ì˜ í†µì‹ ì„ ìœ„í•´ì„œ, ê¸°ì¡´ ë°©ì‹ì€ cluster ipë¥¼ ì´ìš©í•˜ê¸° ë•Œë¬¸ì— ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ë¶ˆê°€ 
- NodePort :íŒŒë“œì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í¬íŠ¸ë¥¼ í´ëŸ¬ìŠ¤í„°ì˜ ëª¨ë“  ë…¸ë“œì— ë™ì¼í•˜ê²Œ ê°œë°©
			ì™¸ë¶€ì—ì„œ íŒŒë“œì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤ íƒ€ì…
			ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í¬íŠ¸ëŠ” ëœë¤ìœ¼ë¡œ ì •í•´ì§€ì§€ë§Œ, íŠ¹ì • í¬íŠ¸ë¡œ ì ‘ê·¼í•˜ë„ë¡ ì„¤ì •í•  ìˆ˜ ìˆìŒ
- LoadBalancer : í´ë¼ìš°ë“œ í”Œë«í¼ì—ì„œ ì œê³µí•˜ëŠ” ë¡œë“œë²¨ëŸ°ì„œë¥¼ ë™ì ìœ¼ë¡œ í”„ë¡œë¹„ì €ë‹í•´ íŒŒë“œì— ì—°ê²°
			NodePort íƒ€ì…ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ì™¸ë¶€ì—ì„œ íŒŒë“œì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ì„œë¹„ìŠ¤ íƒ€ì…
			ì¼ë°˜ì ìœ¼ë¡œ AWS, GCP ë“±ê³¼ ê°™ì€ í´ë¼ìš°ìŠ¤ í”Œë«í¼ í™˜ê²½ì—ì„œ ì‚¬ìš©
- ExternalName : ì™¸ë¶€ ì„œë¹„ìŠ¤ë¥¼ ì¿ ë²„ë„¤í‹°ìŠ¤ ë‚´ë¶€ì—ì„œ í˜¸ì¶œí•˜ê³ ì í•  ë•Œ ì‚¬ìš© 
			í´ëŸ¬ìŠ¤í„° ë‚´ì˜ íŒŒë“œì—ì„œ ì™¸ë¶€ IP ì£¼ì†Œì— ì„œë¹„ìŠ¤ì˜ ì´ë¦„ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆìŒ
 
External nameì„ ì„¤ì •í•´ì„œ ì„œë¹„ìŠ¤ ì´ë¦„ìœ¼ë¡œ ì ‘ê·¼í•  ìˆ˜ ìˆê²Œë” ì ì ˆí•œ ì„œë¹„ìŠ¤ íƒ€ì… ì •ì˜ê°€ í•„ìš”
LoadBalancerë¥¼ ì´ìš©í•´ì„œ í†µì‹ ì„ êµ¬í˜„í•´ë³´ì 
LBëŠ” í´ë¼ìš°ë“œì—ì„œ ì£¼ë¡œ ì‚¬ìš©í•˜ë©°, í”„ë¡œì íŠ¸ëŠ” on premise í™˜ê²½ì—ì„œ êµ¬í˜„í•˜ê¸° ë•Œë¬¸ì— metal lbë¥¼ ì‚¬ìš©

### ì„œë¹„ìŠ¤ ê¸°ëŠ¥ ì¶”ê°€
#### ì„œë¹„ìŠ¤ ê¸°ëŠ¥
- ì—¬ëŸ¬ ê°œì˜ íŒŒë“œì— ì‰½ê²Œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ê³ ìœ í•œ ë„ë©”ì¸ ì´ë¦„ì„ ë¶€ì—¬
- ì—¬ëŸ¬ ê°œì˜ íŒŒë“œì— ì ‘ê·¼í•  ë•Œ, ìš”ì²­ì„ ë¶„ì‚°í•˜ëŠ” ë¡œë“œ ë°¸ëŸ°ì„œ ê¸°ëŠ¥ì„ ìˆ˜í–‰ 
- í´ë¼ìš°ë“œ í”Œë«í¼ì˜ ë¡œë“œ ë°¸ëŸ°ì„œ, í´ëŸ¬ì„œ ë…¸ë“œì˜ í¬íŠ¸ ë“±ì„ í†µí•´ íŒŒë“œë¥¼ ì™¸ë¶€ì— ë…¸ì¶œ

### ë³¼ë¥¨ ê¸°ëŠ¥ ì¶”ê°€ 
#### í¼ì‹œìŠ¤í„´íŠ¸ ë³¼ë¥¨.yaml ìƒì„±
/home/vagrant/mysql-pv.yaml
```yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: mysql-pv
spec:
  capacity:
    storage: 2Gi            # ë³¼ë¥¨ì˜ í¬ê¸° 1G
  accessModes:
    - ReadWriteOnce         # í•˜ë‚˜ì˜ íŒŒë“œ(ë˜ëŠ” ì¸ìŠ¤í„´ìŠ¤)ì— ì˜í•´ì„œë§Œ ë§ˆìš´íŠ¸ ë  ìˆ˜ ìˆìŒ
  hostPath:
    type: DirectoryOrCreate # í•´ë‹¹ ë””ë ‰í„°ë¦¬ë¥¼ íƒìƒ‰í•˜ê³ , ì—†ìœ¼ë©´ ìƒì„±
    path: /data/mysql       # ì›Œì»¤ ë…¸ë“œì—ì„œ ë³¼ë¥¨ì´ ìƒì„±ë  ë””ë ‰í„°ë¦¬
```

#### í¼ì‹œìŠ¤í„´íŠ¸ ë³¼ë¥¨ í¬ë ˆì„ ìƒì„±
/home/vagrant/mysql-pvc.yaml
```yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mysql-pvc
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
```

### POD ê°„ í†µì‹  êµ¬í˜„
```
vagrant@master-node:~$ kubectl get all
NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE
service/kubernetes   ClusterIP   172.17.0.1   <none>        443/TCP   17d
```
#### í¼ì‹œìŠ¤í„´íŠ¸ ë³¼ë¥¨ê³¼ ë³¼ë¥¨í¬ë ˆì„ ë°°í¬
```
vagrant@master-node:~$ kubectl apply -f mysql-pv.yaml
persistentvolume/mysql-pv created
vagrant@master-node:~$ kubectl apply -f mysql-pvc.yaml
persistentvolumeclaim/mysql-pvc created
```
#### deployment/service ë°°í¬
```
vagrant@master-node:~$ kubectl apply -f mysql-deployment.yaml
deployment.apps/mysql-deployment created
service/mysql-service created
vagrant@master-node:~$ kubectl apply -f flask-deployment.yaml
deployment.apps/flask-deployment created
service/flask-service created
vagrant@master-node:~$ kubectl apply -f mysql-deployment.yaml
deployment.apps/mysql-deployment unchanged
service/mysql-service unchanged
vagrant@master-node:~$ kubectl get all
NAME                                    READY   STATUS    RESTARTS   AGE
pod/flask-deployment-db55dcbd7-nwbks    1/1     Running   0          14s
pod/mysql-deployment-5b587d9457-gcqg7   1/1     Running   0          19s

NAME                    TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
service/flask-service   LoadBalancer   172.17.53.73    10.0.0.4      5000:31274/TCP   14s
service/kubernetes      ClusterIP      172.17.0.1      <none>        443/TCP          17d
service/mysql-service   LoadBalancer   172.17.43.138   10.0.0.3      3306:30999/TCP   19s

NAME                               READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/flask-deployment   1/1     1            1           14s
deployment.apps/mysql-deployment   1/1     1            1           19s

NAME                                          DESIRED   CURRENT   READY   AGE
replicaset.apps/flask-deployment-db55dcbd7    1         1         1       14s
replicaset.apps/mysql-deployment-5b587d9457   1         1         1       19s
vagrant@master-node:~$ kubectl apply -f react-deployment.yaml
deployment.apps/react-deployment created
service/react-service created
```
#### PODë“¤ External IPì™€ í†µì‹  í™•ì¸ 
```
vagrant@master-node:~$ kubectl get all
NAME                                    READY   STATUS    RESTARTS   AGE
pod/flask-deployment-db55dcbd7-nwbks    1/1     Running   0          55s
pod/mysql-deployment-5b587d9457-gcqg7   1/1     Running   0          60s
pod/react-deployment-65d6df987c-4lr5z   1/1     Running   0          5s

NAME                    TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
service/flask-service   LoadBalancer   172.17.53.73    10.0.0.4      5000:31274/TCP   55s
service/kubernetes      ClusterIP      172.17.0.1      <none>        443/TCP          17d
service/mysql-service   LoadBalancer   172.17.43.138   10.0.0.3      3306:30999/TCP   60s
service/react-service   LoadBalancer   172.17.27.20    10.0.0.5      3000:32307/TCP   5s

NAME                               READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/flask-deployment   1/1     1            1           55s
deployment.apps/mysql-deployment   1/1     1            1           60s
deployment.apps/react-deployment   1/1     1            1           5s

NAME                                          DESIRED   CURRENT   READY   AGE
replicaset.apps/flask-deployment-db55dcbd7    1         1         1       55s
replicaset.apps/mysql-deployment-5b587d9457   1         1         1       60s
replicaset.apps/react-deployment-65d6df987c   1         1         1       5s
```